# LOD Texture MaxSize 同步工具

## 概述

LOD Texture MaxSize 同步工具是一个 Unity Editor 工具，用于将 LOD 纹理的 MaxSize 导入设置与源 Lod0 纹理保持一致。工具支持自动/自定义两种路径模式，提供可视化预览和批量同步功能，确保 LOD 纹理的质量设置与源纹理保持统一。

## 功能特性

### 核心功能
- **智能纹理匹配**：自动根据文件名匹配 LOD 纹理与源 Lod0 纹理
- **双路径模式**：支持自动模式和自定义模式，灵活适配不同工作流
- **可视化预览**：表格形式展示所有纹理的匹配状态和 MaxSize 对比
- **批量同步**：一键同步所有需要修改的纹理 MaxSize
- **单独调整**：支持针对单个纹理自定义设置目标 MaxSize
- **状态标识**：通过颜色区分不同状态（需同步/已修改/未匹配/已同步）

### 路径模式

#### 自动模式（Auto Mode）
- **输入路径**：选择项目根文件夹
- **LOD纹理路径**：自动识别为 `[项目根目录]/LOD/Texture`
- **源纹理路径**：自动识别为 `[项目根目录]/Texture`
- **适用场景**：标准项目结构，快速批量同步

#### 自定义模式（Custom Mode）
- **LOD纹理文件夹**：自由选择 LOD 纹理所在目录
- **源Lod0纹理文件夹**：自由选择源纹理所在目录
- **适用场景**：非标准项目结构，需要灵活配置路径的场景

## 使用方法

### 方式一：快捷菜单（推荐）
1. 在 Project 窗口中选中项目根文件夹
2. 右键 → `图集生成替换` → `LOD Texture MaxSize Sync`
3. 窗口会自动打开并填充该文件夹路径，自动执行扫描

### 方式二：工具菜单
1. 顶部菜单栏 → `Tools` → `图集生成替换` → `LOD MaxSize同步工具`
2. 手动拖拽或选择文件夹

### 操作步骤

#### 基础流程
1. **选择路径模式**：根据项目需求选择自动或自定义模式
2. **配置路径**：
   - 自动模式：拖拽项目根文件夹或点击「从Selection获取」
   - 自定义模式：分别拖拽或选择 LOD纹理文件夹 和 源Lod0纹理文件夹
3. **扫描纹理**：点击「扫描纹理」按钮执行扫描
4. **查看结果**：在列表中查看所有纹理的匹配状态和 MaxSize 对比
5. **同步 MaxSize**：
   - 点击「应用所有修改」批量同步
   - 或点击单行的「应用」按钮单独同步

#### 纹理匹配规则
- **匹配原则**：LOD 纹理文件名需与源纹理的基础名称一致（忽略大小写）
- **Lod0 后缀**：源纹理支持 `_lod0` 后缀，匹配时自动去除
- **示例**：`cloth_body` (LOD纹理) ↔ `cloth_body_lod0` (源纹理)

#### 功能按钮说明

| 按钮 | 功能说明 |
|-----|---------|
| **扫描纹理** | 执行纹理扫描和匹配 |
| **应用所有修改** | 批量应用所有待修改的 MaxSize 设置 |
| **重置为Lod0值** | 将所有目标 MaxSize 重置为对应 Lod0 纹理的值 |
| **应用** | 应用单个纹理的 MaxSize 修改 |

## 界面说明

### 表格列说明

| 列名 | 说明 |
|-----|------|
| **LOD纹理** | LOD 纹理预览和文件名（可点击定位） |
| **当前MaxSize** | LOD 纹理当前的 MaxSize 导入设置 |
| **Lod0纹理** | 源 Lod0 纹理预览和文件名（可点击定位） |
| **Lod0 MaxSize** | 源纹理的 MaxSize 导入设置 |
| **目标MaxSize** | 期望同步到的 MaxSize 值（可下拉选择） |
| **操作** | 单独应用该行修改的按钮 |

### 行背景颜色说明

| 颜色 | 状态说明 |
|-----|---------|
| **黄色** | 需要同步（LOD MaxSize ≠ Lod0 MaxSize） |
| **青色** | 已修改待应用（目标值已调整但未保存） |
| **红色** | 未匹配（未找到对应的源纹理） |
| **绿色** | 已同步（LOD MaxSize = Lod0 MaxSize） |

### 统计信息
窗口底部显示实时统计：
- **总计**：扫描到的 LOD 纹理总数
- **已匹配**：成功匹配到源纹理的数量
- **需同步**：MaxSize 不一致需要同步的数量
- **已修改待应用**：目标值已修改但未保存的数量

## MaxSize 可选值

工具支持的 MaxSize 选项：
- 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384

## 目录结构要求

### 自动模式要求
[项目根目录]/ 
├── LOD/ 
│ └── Texture/ ← LOD 纹理目录 
│ ├── cloth_body.png 
│ └── cloth_arm.png 
└── Texture/ ← 源 Lod0 纹理目录 
├── cloth_body_lod0.png 
└── cloth_arm_lod0.png

### 自定义模式
无特定目录结构要求，可自由选择任意两个包含纹理的文件夹。

## 常见问题

### Q1: 部分纹理显示"未匹配"？
**A:** 
- 确认 LOD 纹理文件名与源纹理基础名称一致
- 检查源纹理是否使用了 `_lod0` 后缀
- 确认源纹理文件夹路径配置正确

### Q2: 扫描后列表为空？
**A:** 
- 确认 LOD 纹理文件夹中包含有效的纹理文件
- 检查文件夹结构是否符合自动模式要求
- 尝试使用自定义模式手动指定路径

### Q3: 应用修改后纹理质量变化？
**A:** 
- MaxSize 影响纹理的最大分辨率，较小的 MaxSize 会降低纹理质量
- 建议确认源 Lod0 纹理的 MaxSize 设置是否符合预期
- 如需自定义值，可在「目标MaxSize」列下拉选择

### Q4: 批量操作中断了怎么办？
**A:** 
- 已处理的纹理会保存修改
- 重新点击「扫描纹理」刷新状态
- 再次点击「应用所有修改」继续处理

### Q5: 如何只同步部分纹理？
**A:** 
- 在「目标MaxSize」列为不需要修改的纹理选择与当前值相同的选项
- 或使用单行的「应用」按钮逐个处理

## 技术细节

### 扫描流程
1. 验证目录结构有效性
2. 遍历 LOD 纹理目录获取所有 Texture2D
3. 构建源纹理名称映射表（支持 _lod0 后缀）
4. 按文件名匹配 LOD 纹理与源纹理
5. 读取双方的 TextureImporter 获取 MaxSize
6. 按需同步状态排序（需同步 → 未匹配 → 已同步）

### 同步流程
1. 收集所有需要修改的纹理
2. 使用 `AssetDatabase.StartAssetEditing()` 开启批量编辑
3. 逐个更新 TextureImporter.maxTextureSize
4. 使用 `AssetDatabase.StopAssetEditing()` 结束批量编辑
5. 调用 `SaveAndReimport()` 保存并重新导入
6. 刷新 AssetDatabase

### 代码结构

| 文件 | 职责 |
|-----|------|
| `LodTextureMaxSizeSyncWindow.cs` | EditorWindow 主窗口，负责 UI 渲染和交互 |
| `LodMaxSizeScanner.cs` | 纹理扫描和匹配逻辑 |
| `LodMaxSizeSyncProcessor.cs` | MaxSize 同步处理逻辑 |
| `LodMaxSizeData.cs` | 数据结构定义 |
| `LodMaxSizeConstants.cs` | 常量定义 |

## 版本历史

### v1.0（当前版本）
- 🎉 初始版本发布
- ✅ 支持自动模式和自定义模式
- ✅ 可视化纹理匹配和 MaxSize 对比
- ✅ 批量同步和单独调整功能
- ✅ 支持拖拽文件夹操作
- ✅ 右键菜单快捷入口

## 相关工具

- **图集生成器**：将多张散图打包生成优化的纹理图集
- **材质图集替换器**：自动将材质球的散图替换为图集
- **一键图集处理器**：一键完成图集生成和材质替换

---

**开发者**: HiHi2 Atlas Tools Team  
**最后更新**: 2026-01